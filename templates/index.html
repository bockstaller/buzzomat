<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<title>voco-o-mat: Das DPSG Phrasenschwein</title>

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="static/jquery.slotmachine.css" type="text/css" media="screen" />
<link rel="stylesheet" href="static/style.css" type="text/css" media="screen" />
<script type="text/javascript" src="static/content.js"></script>

<script type="text/javascript" src="static/background.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="static/jquery.slotmachine.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.16/clipboard.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<meta property="og:url" content="{{url}}" />
<meta property="og:image" content="{{image}}" />
<meta property="og:title" content="{{title}}" />
<meta property="og:type" content="website" />
<meta property="og:description" content="{{description}}" />
<meta property="og:locale" content="de_DE" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<!-- Matomo -->
<script type="text/javascript">
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(["setDomains", ["*.boggy.uber.space"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//stats.rover.de/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '12']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->

</head>

<body>
  <div class="background">
  </div>
    <div class="wrapper">
      <div class="heading">
          <h1> <b>voco</b>-o-mat </h1>
          <svg width="700" height="300">
            <image xlink:href="static/RV_bubble_dunkelgelb.svg" width="700" height="300"/>
          </svg>
      </div>
      <div id="casino" >
        <div class="content">
          <div style="position:relative" class="machine">

            <div class="elements">
              <div style="width: 46px; height: 152px; position: absolute; right: -118px; top: -70px; cursor:pointer" id="handleBtn"><div style="width:100%;height:100%" class="handle sparkle"></div></div>
              <div class="bullet" style="left:56px"></div>
              <div class="bullet" style="left:92px"></div>
              <div class="bullet" style="left:128px"></div>
              <div class="bullet" style="left:166px"></div>
              <div class="bullet" style="left:202px"></div>
              <div class="bullet" style="left:238px"></div>
              <div class="bullet" style="left:275px"></div>
              <div class="bullet" style="left:312px"></div>
              <div class="bullet" style="left:348px"></div>
              <div class="bullet" style="left:385px"></div>
              <div class="bullet" style="left:422px"></div>
              <div class="bullet" style="left:458px"></div>
              <div class="bullet" style="left:496px"></div>
              <div class="bullet" style="left:532px"></div>
              <div class="bullet" style="left:568px"></div>
              <div class="bullet" style="left:604px"></div>
              <div class="bullet" style="left:642px"></div>
            </div>

            <div class="slots">
              <div id="casino1" class="slotMachine"></div>
              <div id="casino2" class="slotMachine"></div>
              <div id="casino3" class="slotMachine"></div>
              <div id="casino4" class="slotMachine"></div>
            </div>


            <svg width="950" height="500">
              <image xlink:href="static/machine.svg" width="950" height="500"/>
            </svg>

            <div class="btn-group btn-group-justified btn-group-casino" role="group">
              <div id="slotMachineButtonCopyText" type="button" class="btn btn-primary btn-lg">Spruch kopieren</div>
              <div id="slotMachineButtonCopyURL" type="button" class="btn btn-primary btn-lg">Perma-Link kopieren</div>
              <a id="slotMachineButtonTwitter" target="_blank" type="button" class="btn btn-primary btn-lg twitter-share-button">Spruch twittern</a>
            </div>
          </div>


        </div>
      </div>

      <div class="notification">

      </div>
    </div>
    <div class="push"></div>
    <div class="footer">
      Ein Projekt von dem <b>rover</b>voco Vorbereitungsteam</br>
      gebaut mit dem <a href="https://github.com/gitmh/buzzomat" target="_blank">Buzzomat</a> </br>
      <a href="https://dpsg.de/impressum" target="_blank">Impressum</a> </br>
    </div>

    <div class="clear">
    </div>

		<script>
        function set_background(text, image) {
          $('div.notification:first').html(text)

          $('div.background:first').css('background-image', 'none');
          if (image != ""){
            $('div.background:first').css('background-image', 'url(' + image + ')');
          }
        };

        function update_background(machine1, machine2, machine3, machine4) {
            var t = [];
            t.push(parts1[machine1.active]);
            t.push(parts2[machine2.active]);
            t.push(parts3[machine3.active]);
            t.push(parts4[machine4.active]);
            var text_1 = t.join(" ").replace(/&shy;/g,"");

            set_background("<a href=https://voco.rover.de> Für rover<b>voco</b> anmelden! </a><br> Das Bundesunternehmen für die Roverstufe 2022", "");

            for (const background of backgrounds) {
              for(const key of background.keys){
                if (text_1.includes(key)){
                  const randomText = background.texts[Math.floor(Math.random() * background.texts.length)];
                  const randomImage = background.images[Math.floor(Math.random() * background.images.length)];
                  set_background(randomText, randomImage);
                  return;
                }
              }
            }


        };


			$(document).ready(function(){
			  for(var i=0; i < parts1.length; i++)
  			  $('#casino1').append('<div class="slot slot'+(i+1)+'"><div class="inner">'+parts1[i]+'</div></div>');
			  for(var i=0; i < parts2.length; i++)
  			  $('#casino2').append('<div class="slot slot'+(i+1)+'"><div class="inner">'+parts2[i]+'</div></div>');
			  for(var i=0; i < parts3.length; i++)
  			  $('#casino3').append('<div class="slot slot'+(i+1)+'"><div class="inner">'+parts3[i]+'</div></div>');
			  for(var i=0; i < parts4.length; i++)
  			  $('#casino4').append('<div class="slot slot'+(i+1)+'"><div class="inner">'+parts4[i]+'</div></div>');

        $("#casino1").on("click",function(){
          newShuffle(1);
        });
        $("#casino2").on("click",function(){
          newShuffle(2);
        });
        $("#casino3").on("click",function(){
          newShuffle(3);
        });
        $("#casino4").on("click",function(){
          newShuffle(4);
        });

        var target1 = -1;
        var target2 = -1;
        var target3 = -1;
        var target4 = -1;

        function getNextRandom(i){
          var r = 0;
          if(i == 0) {
            r = Math.floor(Math.random()*parts1.length);
            if(target1 != -1) r = target1;
          }
          if(i == 1) {
            r = Math.floor(Math.random()*parts2.length);
            if(target2 != -1) r = target2;
          }
          if(i == 2) {
            r = Math.floor(Math.random()*parts3.length);
            if(target3 != -1) r = target3;
          }
          if(i == 3) {
            r = Math.floor(Math.random()*parts4.length);
            if(target4 != -1) r = target4;
          }
          return parseInt(r);
        };

        function getNextRandom1(){ return getNextRandom(0); }
        function getNextRandom2(){ return getNextRandom(1); }
        function getNextRandom3(){ return getNextRandom(2); }
        function getNextRandom4(){ return getNextRandom(3); }

				var machine1 = $("#casino1").slotMachine({
					active	: 0,
					delay	: 300,
					randomize : getNextRandom1
				});
				var machine2 = $("#casino2").slotMachine({
					active	: 0,
					delay	: 300,
					randomize : getNextRandom2
				});
				var machine3 = $("#casino3").slotMachine({
					active	: 0,
					delay	: 300,
					randomize : getNextRandom3
				});
				var machine4 = $("#casino4").slotMachine({
					active	: 0,
					delay	: 300,
					randomize : getNextRandom4
				});

  		  var backgroundMusic = new Audio("static/background.mp3");
  		  backgroundMusic.loop = true;
        backgroundMusic.play();

  		  var a = new Audio("static/start.mp3");

        var waitForStop = false;
        function newShuffle(w){
				  if(waitForStop) return;

				  $(".handle").addClass("clicked");
				  setTimeout(function(){$(".handle").removeClass("clicked");},1000);

     		  var a = new Audio("static/start.mp3"); a.play();
				  target1 = -1;
				  target2 = -1;
				  target3 = -1;
				  target4 = -1;
					if(w == 0 || w == 1) machine1.shuffle();
					if(w == 0 || w == 2) machine2.shuffle();
					if(w == 0 || w == 3) machine3.shuffle();
					if(w == 0 || w == 4) machine4.shuffle();
					waitForStop = true;
					setTimeout(function(){
  				 machine1.stop();
  				 machine2.stop();
  				 machine3.stop();
   				 machine4.stop();
   				 // define the perma link number for the given sentence
   				 var link = (
   				  (machine1.active*parts2.length*parts3.length*parts4.length) +
            (machine2.active*parts3.length*parts4.length) +
            (machine3.active*parts4.length) +
            (machine4.active)
           );

   				 if(history.pushState) {
             history.pushState(null, null, link);
           }
           foundHash = link;
           setTimeout(function(){ waitForStop = false; },1000);
           update_background(machine1, machine2, machine3, machine4);
					},500);
        }

				$("#slotMachineButtonShuffle").click(function(){newShuffle (0);});
				$("#handleBtn").click(function(){
				  newShuffle (0);
				});

        var foundHash = "";
        setInterval(function() {
         var pathArray = window.location.pathname.split('/');
         h = pathArray[1];

         if(h == ""){
           newShuffle(0);
         }

         if (h && h != "" && h !== foundHash) {
           if(waitForStop){
             // do later
             return;
           }
           var p = parseInt(h.replace(/[^0-9]*/g,""));

           var old1 = machine1.active;
           var old2 = machine2.active;
           var old3 = machine3.active;
           var old4 = machine4.active;

           while(p  > parts3.length * parts1.length*parts2.length*parts4.length)
                 p -= parts3.length * parts1.length*parts2.length*parts4.length;

           target1 = Math.floor(p / (parts2.length*parts3.length*parts4.length));
           p = p - (target1*parts2.length*parts3.length*parts4.length);

           target2 = Math.floor(p / (parts3.length*parts4.length));
           p = p - (target2*parts3.length*parts4.length);

           target3 = Math.floor(p / (parts4.length));
           p = p - (target3*parts4.length);

           target4 = p;

           foundHash = h;

           machine1.settings.delay=0;
           machine2.settings.delay=0;
           machine3.settings.delay=0;
           machine4.settings.delay=0;

           machine1.futureActive = target1;
           machine2.futureActive = target2;
           machine3.futureActive = target3;
           machine4.futureActive = target4;

           machine1.activate();
           machine2.activate();
           machine3.activate();
           machine4.activate();

           console.log(machine1.active)

           machine1.settings.delay=300;
           machine2.settings.delay=300;
           machine3.settings.delay=300;
           machine4.settings.delay=300;
           update_background(machine1, machine2, machine3, machine4);
         }
        }, 100);




        new Clipboard('#slotMachineButtonCopyText', {
          text: function(trigger) {
            var t = [];
            t.push(parts1[machine1.active]);
            t.push(parts2[machine2.active]);
            t.push(parts3[machine3.active]);
            t.push(parts4[machine4.active]);
            var btnText = $("#slotMachineButtonCopyText").text();
            $("#slotMachineButtonCopyText").text("in Zwischenablage kopiert!");
            setTimeout(function(){
              $("#slotMachineButtonCopyText").text(btnText);
            },1000);
            return t.join(" ").replace(/&shy;/g,"");
          }
        });

        new Clipboard('#slotMachineButtonCopyURL', {
          text: function(trigger) {
            var t = [];
            t.push(parts1[machine1.active]);
            t.push(parts2[machine2.active]);
            t.push(parts3[machine3.active]);
            t.push(parts4[machine4.active]);
            var btnText = $("#slotMachineButtonCopyURL").text();
            $("#slotMachineButtonCopyURL").text("in Zwischenablage kopiert!");
            setTimeout(function(){
              $("#slotMachineButtonCopyURL").text(btnText);
            },1000);

            return window.location.href;
          }
        });

        $('#slotMachineButtonTwitter').click(function(){
           var t = [];
           t.push(parts1[machine1.active]);
           t.push(parts2[machine2.active]);
           t.push(parts3[machine3.active]);
           t.push(parts4[machine4.active]);
           var text = t.join(" ").replace(/&shy;/g,"");

   				 var link = (
   				  (machine1.active*parts2.length*parts3.length*parts4.length) +
            (machine2.active*parts3.length*parts4.length) +
            (machine3.active*parts4.length) +
            (machine4.active)
           );

           window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(text+' #vocomat #dpsg '+window.location.href),'twitter','width=500,height=350');
        });

        $(document).keydown(function (e){
          var p = parseInt(window.location.hash.replace(/[^0-9]*/g,""));
          if(e.keyCode == 37 || e.keyCode == 38) {
            window.location.hash = '#'+(p-1);
          }
          else if(e.keyCode == 39 || e.keyCode == 40) {
            window.location.hash = '#'+(p+1);
          }
        });





			});



		</script>




</body>
</html>